<dom-module id="sidebar-default">
	<template>
		<style>
		/* Custom px-pocket styling */
		
		/*:host px-pocket {
			width: 375px;
			display: block;
			padding: 15px 25px 0px 25px;
			box-sizing: border-box;
			background-color: rgba(241, 240, 240, .9);
			box-shadow: inset 0 1px 0px rgba(255, 255, 255, .05), 0 -8px 20px -6px rgba(0, 0, 0, .25);
			border: 1px solid #c1c1c1;
			border-left: 0;
			border-bottom: 0;
		}
		
		:host px-pocket[dark],
		:host-context([dark]) px-pocket {
			background: rgba(33, 33, 33, .9);
			border-color: rgba(0, 0, 0, .25);
			box-shadow: inset 0 1px 0px rgba(255, 255, 255, .05), 0 -8px 20px -6px rgba(0, 0, 0, .65);
			color: #f3f3f3;
		}
		
		:host px-pocket #pocketWrapper {
			@apply(--layout-vertical);
		}
		
		:host px-pocket #pocketWrapper ::content > .action px-button {
			width: 100%;
			margin-bottom: 15px;
		}
		
		:host px-pocket #pocketWrapper ::content > .action px-title {
			text-align: center;
			margin-bottom: 15px;
		}*/
		
		/*:host px-pocket[hidden] {
			display: none;
		}*/
		</style>
		<px-sidebar  dark floating closed$="[[hideSidebar]]" class="layout vertical">
			<px-actionbar>
				<template is="dom-if" if="{{icon}}">
					<iron-icon icon="[[icon]]"></iron-icon>
				</template>
				<content select=".title"></content>
			</px-actionbar>
			
			<template is="dom-repeat" items="[[distChildren]]">
				<px-row>
					<px-column>
						<span>[[getLabel(labels.*, item)]]</span>
						<br />
				
						<content select=".item[[item]]"></content>
					</px-column>
				</px-row>
			</template>
			<content select=".content"></content>
			<content select=".pocket"></content>
		</px-sidebar>
	</template>
	<script>

		Polymer({
			is: 'sidebar-default',
			behaviors: [
				PB.behaviors.navElem,
				PB.behaviors.disabled,
				PB.behaviors.distribute
			],
			properties: {
				labels: Object,
				hasAction: Boolean
			},
			observers: [
				"onDisabled(disableEdit)"
			],
			onDisabled: function(disableEdit) {
				if (!this.labels) {
					return;
				}
				var distChildren;
				if (disableEdit) {
					var children = this.getEffectiveChildren();
					distChildren = []
					for (var n in this.labels) {
						var param = children[n].param;
						if (param && param.input_type !== "password") {
							distChildren.push(n);
						}
					}
				} else {
					distChildren = Object.keys(this.labels);
				}
				if (!PB.equals(distChildren, this.distChildren)) {
					this.set("distChildren", distChildren);
				}
			},
			getLabel: function(change, index) {
				return change.base[index];
			},
			onChildren: function() {
				// Expand username & password children
				var self = this;
				var children = self.getEffectiveChildren();
				var labels = {};
				var hasAction = false;
				for (var i = 0; i < children.length; i++) {
					var child = children[i];
					if (PB.isAction(child)) {
						hasAction = true;
					}
					if (child.param) {
						if (!child.sidebarName) {
							labels[i] = child.param.desc;
						} else {
							labels[i] = child.sidebarName;
						}
					}
				}
				self.set("labels", labels);
				self.set("hasAction", hasAction);
				setTimeout(function() {
					self.onDisabled(self.disableEdit);
				});
			}
		});
	</script>
</dom-module>
